name: Build Production Page
on: 
   push:
      branches: [wu_main]
      paths-ignore: 
       - '**.md'
       - '**.txt'
       - '.github/**'
       - '!.github/workflows/**'
jobs:
   setup:
    name: Setup Project Info
    runs-on: ubuntu-latest
    outputs:
       DIST_SUFFIX: ${{ steps.get-suffix.outputs.DIST_SUFFIX }}
    steps: 
     - name: ğŸ§ Checkout
       id: checkout
       uses: actions/checkout@v4
       with: 
          fetch-depth: '0'

     - name: ğŸ“™ Get Package Suffix
       id: get-suffix
       run: |
         ## æ­¤å¤„é€šè¿‡ jq ä» packagr.json è·å–ç‰ˆæœ¬ï¼Œå¦åˆ™åœ¨ depth 
         ## ä¸º 1 æ—¶é€šè¿‡ git tag æ‰€è¯»å–çš„ç‰ˆæœ¬ä¸å‡†ç¡®
         sudo apt-get install jq
         VERSION=$(jq -r '.version' ./package.json)
         
         COMMIT_COUNT=$(git rev-list --count HEAD)
         BUILD_DATE=$(date "+%y%m%d")
         HEAD_SHA=$(git rev-parse --short HEAD)
         echo "DIST_SUFFIX=v${VERSION}-${COMMIT_COUNT}-${BUILD_DATE}-${HEAD_SHA}" >> $GITHUB_OUTPUT

   build:
      name: Build Production Page
      needs: setup
      env:
         DIST_NAME: dist-${{ needs.setup.outputs.DIST_SUFFIX }}
      runs-on: ubuntu-latest
      steps:
       - name: ğŸ› ï¸ Setup environment
         id: setup
         uses: crrashh1542/action-setup-yarn-berry@v1

       - name: âš™ï¸ Build production pages
         id: build
         run: |
            yarn add @vue/cli
            yarn build

       - name: ğŸŒ Upload the build
         id: upload
         uses: actions/upload-artifact@v4
         with:
             name: ${{ env.DIST_NAME }}
             path: dist
             retention-days: 60
